



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Reefer Container Management Service</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#springboot-kafka-container-microservice" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Reefer Container Management Service" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Reefer Container Management Service
            </span>
            <span class="md-header-nav__topic">
              Springboot - Kafka and PostgreSQL
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-kc-container-ms/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Reefer Container Management Service" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Reefer Container Management Service
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-kc-container-ms/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../kstreams/" title="Kafka Streams Implementation" class="md-nav__link">
      Kafka Streams Implementation
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Springboot - Kafka and PostgreSQL
      </label>
    
    <a href="./" title="Springboot - Kafka and PostgreSQL" class="md-nav__link md-nav__link--active">
      Springboot - Kafka and PostgreSQL
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#start-from-spring-initializer" title="Start from Spring initializer" class="md-nav__link">
    Start from Spring initializer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-from-ibm-cloud-starter-kit" title="Start from IBM Cloud Starter Kit." class="md-nav__link">
    Start from IBM Cloud Starter Kit.
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-pom" title="New pom" class="md-nav__link">
    New pom
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#some-springboot-knowledge" title="Some Springboot knowledge" class="md-nav__link">
    Some Springboot knowledge
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-the-get-all-containers" title="Add the get all containers" class="md-nav__link">
    Add the get all containers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listening-to-container-events" title="Listening to container events" class="md-nav__link">
    Listening to container events
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../flask/" title="Python Flask and Kafka Implementation" class="md-nav__link">
      Python Flask and Kafka Implementation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../metrics/" title="Container Predictive Maintenance" class="md-nav__link">
      Container Predictive Maintenance
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#start-from-spring-initializer" title="Start from Spring initializer" class="md-nav__link">
    Start from Spring initializer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-from-ibm-cloud-starter-kit" title="Start from IBM Cloud Starter Kit." class="md-nav__link">
    Start from IBM Cloud Starter Kit.
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-pom" title="New pom" class="md-nav__link">
    New pom
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#some-springboot-knowledge" title="Some Springboot knowledge" class="md-nav__link">
    Some Springboot knowledge
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-the-get-all-containers" title="Add the get all containers" class="md-nav__link">
    Add the get all containers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listening-to-container-events" title="Listening to container events" class="md-nav__link">
    Listening to container events
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-kc-container-ms/edit/master/docs/springboot/README.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="springboot-kafka-container-microservice">Springboot - kafka container microservice</h1>
<h2 id="start-from-spring-initializer">Start from Spring initializer</h2>
<p>Using the <a href="https://start.spring.io/">Spring Code generator</a> we create the base project. </p>
<p><img alt="" src="spr-initializr.png" /></p>
<p>The generated code is really minimum and the interesting part is the pom dependencies. We do not have code related to the selected dependant, no dockerfile and all the goodies to deploy to IBM Kubernetes Service are not there. In fact, if you have a cloud foundry organization defined the IBM cloud, you can use the IBM Cloud CLI for developer to add docker, helm and other things. </p>
<p>It is possible, and more convenient to start from IBM Cloud starter kit and modify the generared <code>pom.xml</code>.</p>
<h2 id="start-from-ibm-cloud-starter-kit">Start from IBM Cloud Starter Kit.</h2>
<p>Once logged to IBM Cloud, create a resource and select Starter kit in the Catalog.</p>
<p><img alt="" src="spr-ic-start.png" /></p>
<p>The application is created, you can download the code or create a toolchain so we can deploy to an existing IBM Kubernetes Service.</p>
<p><img alt="" src="spr-ic-app.png" /></p>
<p>So now the repository has Dockerfile, helm chart, CLI configuration... We can build and run with the following commands:</p>
<pre><code class="shell">$ mvn clean package
$ java -jar target/SpringContainerMS-1.0-SNAPSHOT.jar application.SBApplication
</code></pre>

<p>Pointing to http://localhost:8080/ will bring the first page. It works! so let break it.</p>
<p>We need to merge both code or modify the pom and run <code>mvn install</code>. Before that as we are using Eclipse last release we can install Spring IDE plugin. Before that ensure you get the last updates from eclipse, uisng the 'update Software' menu. If not the installation may fail. See <a href="https://www.eclipse.org/community/eclipse_newsletter/2018/february/springboot.php">this note</a> in case you want to know how to do that, but this is simple, open Marketplace and search for Spring IDE, download release 4.x:</p>
<p><img alt="" src="eclipse-spr-ide.png" /></p>
<h3 id="new-pom">New pom</h3>
<p>The generated dependencies include Spring boot starter web code, hystrix for circuit breaker and retries, and testing. We need to add kafka and postgreSQL</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;
    &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.postgresql&lt;/groupId&gt;
    &lt;artifactId&gt;postgresql&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;
    &lt;artifactId&gt;spring-kafka-test&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>

<p>Then reun <code>mvn install</code>.</p>
<h2 id="some-springboot-knowledge">Some Springboot knowledge</h2>
<p>We encourage you to go over the different tutorials from spring.io. We followed these ones to be sure we got understanding of the basic components:</p>
<ul>
<li><a href="https://spring.io/guides/gs/spring-boot/">Springboot</a>. Helps to start quickly application. The first class as the main function and run the SpringApplcation. The <code>@SpringBootApplication</code> annotation adds configuration to get the spring bean definitions, and auto configure the bean jars needed. As we specified the <code>pring-boot-starter-web</code> artifact in the dependencoes the application is a web MVC and includes a Dispatcher servlet. </li>
</ul>
<h2 id="add-the-get-all-containers">Add the get all containers</h2>
<p>We want to add the get containers in the test and implement a simple container bean and operation. Spring takes into account the package names to manage its dependencies and settings. The test looks like:</p>
<pre><code class="java"> String endpoint = &quot;http://localhost:&quot; + port + &quot;/containers&quot;;
String response = server.getForObject(endpoint, String.class);
assertTrue(&quot;Invalid response from server : &quot; + response, response.startsWith(&quot;[&quot;));
</code></pre>

<p>And the resource class under the package <code>ibm.labs.kc.containermgr.rest.containers</code> with naming convention starting from where the <code>SBApplication</code> application is (<code>ibm.labs.kc.containermgr</code>). </p>
<pre><code class="java">package ibm.labs.kc.containermgr.rest.containers;
@RestController
public class ContainerResource {


    @RequestMapping(&quot;containers&quot;)
</code></pre>

<h2 id="listening-to-container-events">Listening to container events</h2>
<p>So the implementation is not focuing on <a href="https://spring.io/projects/spring-kafka">Spring Kafka</a> template to listen and send messages. It is based on the pure java kafka-clients jar. Here is the <a href="https://docs.spring.io/spring-kafka/docs/2.2.4.RELEASE/reference/">product documentation</a> and a quick summary, in next section on how we use it. But first, using our <a href="">docker compose</a> file we started our local kafka and zookeeper. </p>
<p>As we want to receive container events we need to define a <a href="https://docs.spring.io/spring-kafka/docs/2.2.4.RELEASE/reference/#receiving-messages">a Spring Kafka container</a>.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://start.spring.io/">Spring Code generator</a></li>
<li><a href="https://spring.io/projects/spring-kafka">Spring Kafka</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../kstreams/" title="Kafka Streams Implementation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Kafka Streams Implementation
              </span>
            </div>
          </a>
        
        
          <a href="../flask/" title="Python Flask and Kafka Implementation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Python Flask and Kafka Implementation
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>